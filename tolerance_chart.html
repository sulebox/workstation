<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>はめ合い公差 ＆ ネジ下穴径 一覧ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- テーマ定義 (CSS変数) --- */
        :root {
            /* Default: チョコミント (Mint) */
            --bg: #E0F7FA;
            --main: #3E2723;
            --accent: #26C6DA;
            --card: #FFFFFF;
            --text-sec: #5D4037;
            --sub-card: #B2EBF2;
            --highlight-bg: #3E2723;
            --highlight-text: #FFFFFF;
        }

        [data-theme="banana"] {
            /* チョコバナナ */
            --bg: #FEF9E7;
            --main: #3E2723;
            --accent: #FDD835;
            --card: #FFFFFF;
            --text-sec: #5D4037;
            --sub-card: #FFF59D;
            --highlight-bg: #FDD835;
            --highlight-text: #3E2723;
        }

        [data-theme="strawberry"] {
            /* ストロベリーチョコ */
            --bg: #FCE4EC;
            --main: #3E2723;
            --accent: #F06292;
            --card: #FFFFFF;
            --text-sec: #880E4F;
            --sub-card: #F8BBD0;
            --highlight-bg: #EC407A;
            --highlight-text: #FFFFFF;
        }

        /* --- ベーススタイル適用 --- */
        body {
            background-color: var(--bg);
            color: var(--main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .theme-text-main { color: var(--main); }
        .theme-text-accent { color: var(--accent); }
        .theme-text-sec { color: var(--text-sec); }
        .theme-bg-accent { background-color: var(--accent); }
        .theme-bg-main { background-color: var(--main); }
        .theme-border-accent { border-color: var(--accent); }
        
        /* タブのアクティブ状態制御用クラス */
        .tab-active {
            background-color: var(--accent);
            color: var(--highlight-text); /* バナナテーマなどを考慮 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: scale(1);
        }
        .tab-inactive {
            color: var(--main);
            opacity: 0.6;
        }
        .tab-inactive:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }

        /* 入力フォームのフォーカスリング色 */
        .focus-ring:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 sm:p-6" data-theme="mint">

    <!-- Header -->
    <header class="w-full max-w-md mb-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-4">
            <div class="p-3 rounded-full shadow-lg transition-colors duration-300 theme-bg-main">
                <!-- Settings Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </div>
        </div>
        <h1 class="text-2xl font-bold tracking-wide theme-text-main">エンジニアリングツール</h1>
        
        <!-- Theme Selector -->
        <div class="mt-4 flex justify-center">
            <div class="relative inline-flex items-center group">
                <!-- Palette Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 text-gray-500 pointer-events-none"><circle cx="13.5" cy="6.5" r=".5"></circle><circle cx="17.5" cy="10.5" r=".5"></circle><circle cx="8.5" cy="7.5" r=".5"></circle><circle cx="6.5" cy="12.5" r=".5"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path></svg>
                
                <select id="themeSelect" class="appearance-none pl-10 pr-8 py-2 rounded-full text-sm font-bold shadow-sm border border-black/10 focus:outline-none focus:ring-2 cursor-pointer transition-all duration-300 bg-white/80 hover:bg-white theme-text-main theme-border-accent focus-ring">
                    <option value="mint">チョコミント</option>
                    <option value="banana">チョコバナナ</option>
                    <option value="strawberry">ストロベリーチョコ</option>
                </select>
                <!-- Chevron Down -->
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute right-3 pointer-events-none"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <div class="w-full max-w-md bg-white/50 p-1 rounded-xl flex shadow-sm mb-6 backdrop-blur-sm">
        <button id="tabBtnScrew" class="flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-sm font-bold transition-all duration-300 tab-active">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"></path><line x1="13" y1="7" x2="14" y2="8"></line><line x1="9" y1="11" x2="10" y2="12"></line><line x1="5" y1="15" x2="6" y2="16"></line><line x1="17" y1="3" x2="18" y2="4"></line></svg>
            ネジ下穴径
        </button>
        <button id="tabBtnTolerance" class="flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-sm font-bold transition-all duration-300 tab-inactive">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
            はめ合い公差
        </button>
    </div>

    <!-- Main Content -->
    <main class="w-full max-w-md">
        
        <!-- SCREW THREAD TOOL SECTION -->
        <div id="viewScrew" class="bg-white rounded-2xl shadow-lg overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div class="p-6 border-b border-gray-100 transition-colors duration-300">
                <h2 class="text-lg font-bold flex items-center gap-2 theme-text-main">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-text-accent"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>
                    ISOメートル並目ネジ
                </h2>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- Selector -->
                <div class="space-y-2">
                    <label class="text-sm font-bold ml-1 theme-text-sec">呼び径 (サイズ) を選択</label>
                    <div class="relative">
                        <select id="screwSelect" class="w-full p-4 text-lg font-bold bg-gray-50 border-2 border-gray-200 rounded-xl appearance-none focus:outline-none focus-ring transition-colors cursor-pointer theme-text-main">
                            <!-- Options populated by JS -->
                        </select>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                </div>

                <!-- Result Cards -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- Pitch -->
                    <div class="rounded-xl p-4 flex flex-col items-center justify-center text-center border transition-colors duration-300" style="background-color: var(--bg); border-color: var(--sub-card);">
                        <span class="text-sm font-bold opacity-70 mb-1 theme-text-sec">ピッチ</span>
                        <div class="text-3xl font-black theme-text-main">
                            <span id="screwPitch">0.50</span><span class="text-base font-medium ml-1 opacity-60">mm</span>
                        </div>
                    </div>

                    <!-- Hole Size (Highlighted) -->
                    <div class="rounded-xl p-4 flex flex-col items-center justify-center text-center shadow-md transform scale-105 ring-2 transition-all duration-300" style="background-color: var(--highlight-bg); color: var(--highlight-text); --tw-ring-color: var(--accent);">
                        <span class="text-sm font-bold opacity-80 mb-1">下穴径</span>
                        <div class="text-4xl font-black">
                            <span id="screwHole">2.50</span><span class="text-lg font-medium ml-1 opacity-80">mm</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-3 rounded-lg text-xs text-gray-500 flex gap-2 items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 mt-0.5 theme-text-accent"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <span>一般的な切削タップ用の下穴径です。転造タップの場合は異なりますのでご注意ください。</span>
                </div>
            </div>
        </div>

        <!-- TOLERANCE TOOL SECTION (Hidden by default) -->
        <div id="viewTolerance" class="hidden bg-white rounded-2xl shadow-lg overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div class="p-6 border-b border-gray-100 transition-colors duration-300">
                <h2 class="text-lg font-bold flex items-center gap-2 theme-text-main">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-text-accent"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
                    はめ合い公差 (JIS B 0401)
                </h2>
            </div>

            <div class="p-6 space-y-6">
                <!-- Inputs -->
                <div class="grid grid-cols-1 gap-4">
                    <div class="space-y-1">
                        <label class="text-xs font-bold uppercase tracking-wider text-gray-500 ml-1">基準寸法 (直径)</label>
                        <div class="relative flex items-center">
                            <input type="number" id="diameterInput" value="10" class="w-full p-3 pl-4 text-xl font-bold bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus-ring transition-colors text-center theme-text-main">
                            <span class="absolute right-4 font-bold text-gray-400">mm</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-xs font-bold uppercase tracking-wider text-gray-500 ml-1">穴クラス</label>
                            <div class="relative">
                                <select id="holeClassSelect" class="w-full p-3 font-bold bg-gray-50 border-2 border-gray-200 rounded-xl appearance-none focus:outline-none focus-ring transition-colors text-center theme-text-main">
                                    <!-- Populated by JS -->
                                </select>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold uppercase tracking-wider text-gray-500 ml-1">軸クラス</label>
                            <div class="relative">
                                <select id="shaftClassSelect" class="w-full p-3 font-bold bg-gray-50 border-2 border-gray-200 rounded-xl appearance-none focus:outline-none focus-ring transition-colors text-center theme-text-main">
                                    <!-- Populated by JS -->
                                </select>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div id="tolError" class="hidden p-4 bg-red-50 text-red-600 rounded-xl text-center font-bold text-sm"></div>

                <div id="tolResults" class="space-y-4">
                    <!-- Dimensions -->
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Hole -->
                        <div class="bg-gray-50 rounded-xl p-3 border border-gray-100 relative">
                            <div class="absolute top-0 left-0 w-full h-1 rounded-t-xl theme-bg-accent"></div>
                            <span class="text-xs font-bold text-gray-400 block mb-1">穴 (<span id="dispHoleClass">H7</span>)</span>
                            <div class="flex justify-between items-baseline">
                                <span class="text-2xl font-bold text-gray-700" id="dispHoleDia">10</span>
                                <div class="flex flex-col text-right text-xs font-mono font-medium text-gray-500">
                                    <span id="holeTolMax">+0.015</span>
                                    <span id="holeTolMin">0</span>
                                </div>
                            </div>
                            <div class="mt-2 pt-2 border-t border-gray-200 flex justify-between text-xs font-bold theme-text-sec">
                                <span>Max: <span id="holeAbsMax">10.015</span></span>
                                <span>Min: <span id="holeAbsMin">10.000</span></span>
                            </div>
                        </div>

                        <!-- Shaft -->
                        <div class="bg-gray-50 rounded-xl p-3 border border-gray-100 relative">
                            <div class="absolute top-0 left-0 w-full h-1 rounded-t-xl theme-bg-main"></div>
                            <span class="text-xs font-bold text-gray-400 block mb-1">軸 (<span id="dispShaftClass">h7</span>)</span>
                            <div class="flex justify-between items-baseline">
                                <span class="text-2xl font-bold text-gray-700" id="dispShaftDia">10</span>
                                <div class="flex flex-col text-right text-xs font-mono font-medium text-gray-500">
                                    <span id="shaftTolMax">0</span>
                                    <span id="shaftTolMin">-0.015</span>
                                </div>
                            </div>
                            <div class="mt-2 pt-2 border-t border-gray-200 flex justify-between text-xs font-bold theme-text-sec">
                                <span>Max: <span id="shaftAbsMax">10.000</span></span>
                                <span>Min: <span id="shaftAbsMin">9.985</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Fit Status -->
                    <div class="rounded-xl p-4 shadow-md relative overflow-hidden text-white transition-colors duration-300 theme-bg-main">
                        <div class="absolute -right-4 -top-4 w-24 h-24 rounded-full opacity-20 blur-xl theme-bg-accent"></div>
                        <div class="relative z-10">
                            <div class="text-xs font-bold uppercase tracking-widest mb-1 opacity-80" style="color: var(--bg);">はめ合い状態</div>
                            <div class="text-xl font-bold mb-3 flex items-center gap-2">
                                <div id="fitIndicator" class="w-3 h-3 rounded-full animate-pulse"></div>
                                <span id="fitTypeLabel">隙間ばめ</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 bg-white/10 p-3 rounded-lg backdrop-blur-sm">
                                <div class="text-center">
                                    <span id="fitVal1Label" class="text-xs block opacity-80" style="color: var(--bg);">最大隙間</span>
                                    <span class="text-lg font-mono font-bold"><span id="fitVal1">30</span> <span class="text-xs opacity-60">μm</span></span>
                                </div>
                                <div class="text-center">
                                    <span id="fitVal2Label" class="text-xs block opacity-80" style="color: var(--bg);">最小隙間</span>
                                    <span class="text-lg font-mono font-bold"><span id="fitVal2">0</span> <span class="text-xs opacity-60">μm</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="mt-12 text-xs text-center opacity-60 max-w-xs pb-4">
        <p>※ データはJIS/ISO規格に基づきますが、実際の加工時は図面指示に従ってください。</p>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- DATA DEFINITIONS ---
        const screwHoleData = [
            { label: 'M1', pitch: 0.25, hole: 0.75 }, { label: 'M1.1', pitch: 0.25, hole: 0.85 },
            { label: 'M1.2', pitch: 0.25, hole: 0.95 }, { label: 'M1.4', pitch: 0.3, hole: 1.10 },
            { label: 'M1.6', pitch: 0.35, hole: 1.25 }, { label: 'M1.8', pitch: 0.35, hole: 1.45 },
            { label: 'M2', pitch: 0.4, hole: 1.60 }, { label: 'M2.2', pitch: 0.45, hole: 1.75 },
            { label: 'M2.5', pitch: 0.45, hole: 2.05 }, { label: 'M3', pitch: 0.5, hole: 2.50 },
            { label: 'M3.5', pitch: 0.6, hole: 2.90 }, { label: 'M4', pitch: 0.7, hole: 3.30 },
            { label: 'M4.5', pitch: 0.75, hole: 3.70 }, { label: 'M5', pitch: 0.8, hole: 4.20 },
            { label: 'M6', pitch: 1.0, hole: 5.00 }, { label: 'M7', pitch: 1.0, hole: 6.00 },
            { label: 'M8', pitch: 1.25, hole: 6.80 }, { label: 'M9', pitch: 1.25, hole: 7.80 },
            { label: 'M10', pitch: 1.5, hole: 8.50 }, { label: 'M11', pitch: 1.5, hole: 9.50 },
            { label: 'M12', pitch: 1.75, hole: 10.20 },
        ];

        const rangeKeys = [
            { max: 3, key: '0-3' }, { max: 6, key: '3-6' }, { max: 10, key: '6-10' },
            { max: 14, key: '10-14' }, { max: 18, key: '14-18' }, { max: 24, key: '18-24' },
            { max: 30, key: '24-30' },
        ];

        // Renamed 't' to 'makeRange' to avoid conflicts
        const makeRange = (v1, v2, v3, v4, v5) => ({ '0-3': v1, '3-6': v2, '6-10': v3, '10-14': v4, '14-18': v4, '18-24': v5, '24-30': v5 });

        const holeToleranceData = {
            'B10': makeRange([180, 140], [188, 140], [208, 150], [220, 150], [244, 160]),
            'C9': makeRange([85, 60], [100, 70], [116, 80], [138, 95], [162, 110]),
            'C10': makeRange([100, 60], [118, 70], [138, 80], [165, 95], [194, 110]),
            'D8': makeRange([34, 20], [48, 30], [62, 40], [77, 50], [98, 65]),
            'D9': makeRange([45, 20], [60, 30], [76, 40], [93, 50], [117, 65]),
            'D10': makeRange([60, 20], [78, 30], [98, 40], [120, 50], [149, 65]),
            'E7': makeRange([24, 14], [32, 20], [40, 25], [50, 32], [61, 40]),
            'E8': makeRange([28, 14], [38, 20], [47, 25], [59, 32], [73, 40]),
            'E9': makeRange([39, 14], [50, 20], [61, 25], [75, 32], [92, 40]),
            'F6': makeRange([12, 6], [18, 10], [22, 13], [27, 16], [33, 20]),
            'F7': makeRange([16, 6], [22, 10], [28, 13], [34, 16], [41, 20]),
            'F8': makeRange([20, 6], [28, 10], [35, 13], [43, 16], [53, 20]),
            'G6': makeRange([8, 2], [12, 4], [14, 5], [17, 6], [20, 7]),
            'G7': makeRange([12, 2], [16, 4], [20, 5], [24, 6], [28, 7]),
            'H6': makeRange([6, 0], [8, 0], [9, 0], [11, 0], [13, 0]),
            'H7': makeRange([10, 0], [12, 0], [15, 0], [18, 0], [21, 0]),
            'H8': makeRange([14, 0], [18, 0], [22, 0], [27, 0], [33, 0]),
            'H9': makeRange([25, 0], [30, 0], [36, 0], [43, 0], [52, 0]),
            'H10': makeRange([40, 0], [48, 0], [58, 0], [70, 0], [84, 0]),
            'JS6': makeRange([3, -3], [4, -4], [4.5, -4.5], [5.5, -5.5], [6.5, -6.5]),
            'JS7': makeRange([5, -5], [6, -6], [7.5, -7.5], [9, -9], [10.5, -10.5]),
            'K6': makeRange([0, -6], [2, -6], [2, -7], [2, -9], [2, -11]),
            'K7': makeRange([0, -10], [3, -9], [5, -10], [6, -12], [6, -15]),
            'M6': makeRange([-2, -8], [-1, -9], [-3, -12], [-4, -15], [-4, -17]),
            'M7': makeRange([-2, -12], [0, -12], [0, -15], [0, -18], [0, -21]),
            'N6': makeRange([-4, -10], [-5, -13], [-7, -16], [-9, -20], [-11, -24]),
            'N7': makeRange([-4, -14], [-4, -16], [-4, -19], [-5, -23], [-7, -28]),
            'P6': makeRange([-6, -12], [-9, -17], [-12, -21], [-15, -26], [-18, -31]),
            'P7': makeRange([-6, -16], [-8, -20], [-9, -24], [-11, -29], [-14, -35]),
            'R7': makeRange([-10, -20], [-11, -23], [-13, -28], [-16, -34], [-20, -41]),
            'S7': makeRange([-14, -24], [-15, -27], [-17, -32], [-21, -39], [-27, -48]),
            'T7': makeRange([null, null], [-19, -31], [-22, -37], [-26, -44], [-33, -54]),
            'U7': makeRange([-18, -28], [-24, -36], [-28, -43], [-33, -51], [-40, -61]),
            'X7': makeRange([-20, -30], [-28, -40], [-34, -49], [-40, -58], [-54, -75]),
        };

        const shaftToleranceData = {
            'b9': makeRange([-140, -165], [-140, -170], [-150, -186], [-150, -193], [-160, -212]),
            'c9': makeRange([-60, -85], [-70, -100], [-80, -116], [-95, -138], [-110, -162]),
            'd8': makeRange([-20, -34], [-30, -48], [-40, -62], [-50, -77], [-65, -98]),
            'd9': makeRange([-20, -45], [-30, -60], [-40, -76], [-50, -93], [-65, -117]),
            'e7': makeRange([-14, -24], [-20, -32], [-25, -40], [-32, -50], [-40, -61]),
            'e8': makeRange([-14, -28], [-20, -38], [-25, -47], [-32, -59], [-40, -73]),
            'e9': makeRange([-14, -39], [-20, -50], [-25, -61], [-32, -75], [-40, -92]),
            'f6': makeRange([-6, -12], [-10, -18], [-13, -22], [-16, -27], [-20, -33]),
            'f7': makeRange([-6, -16], [-10, -22], [-13, -28], [-16, -34], [-20, -41]),
            'f8': makeRange([-6, -20], [-10, -28], [-13, -35], [-16, -43], [-20, -53]),
            'g5': makeRange([-2, -6], [-4, -9], [-5, -11], [-6, -14], [-7, -16]),
            'g6': makeRange([-2, -8], [-4, -12], [-5, -14], [-6, -17], [-7, -20]),
            'h5': makeRange([0, -4], [0, -5], [0, -6], [0, -8], [0, -9]),
            'h6': makeRange([0, -6], [0, -8], [0, -9], [0, -11], [0, -13]),
            'h7': makeRange([0, -10], [0, -12], [0, -15], [0, -18], [0, -21]),
            'h8': makeRange([0, -14], [0, -18], [0, -22], [0, -27], [0, -33]),
            'h9': makeRange([0, -25], [0, -30], [0, -36], [0, -43], [0, -52]),
            'js5': makeRange([2, -2], [2.5, -2.5], [3, -3], [4, -4], [4.5, -4.5]),
            'js6': makeRange([3, -3], [4, -4], [4.5, -4.5], [5.5, -5.5], [6.5, -6.5]),
            'js7': makeRange([5, -5], [6, -6], [7.5, -7.5], [9, -9], [10.5, -10.5]),
            'k5': makeRange([4, 0], [6, 1], [7, 1], [9, 1], [11, 2]),
            'k6': makeRange([6, 0], [9, 1], [10, 1], [12, 1], [15, 2]),
            'm5': makeRange([6, 2], [9, 4], [12, 6], [15, 7], [17, 8]),
            'm6': makeRange([8, 2], [12, 4], [15, 6], [18, 7], [21, 8]),
            'n5': makeRange([8, 4], [13, 8], [16, 10], [20, 12], [24, 15]),
            'n6': makeRange([10, 4], [16, 8], [19, 10], [23, 12], [28, 15]),
            'p6': makeRange([12, 6], [20, 12], [24, 15], [29, 18], [35, 22]),
            'r6': makeRange([16, 10], [23, 15], [28, 19], [34, 23], [41, 28]),
            's6': makeRange([20, 14], [27, 19], [32, 23], [39, 28], [48, 35]),
            't6': makeRange([null, null], [null, null], [null, null], [null, null], [54, 41]),
            'u6': makeRange([24, 18], [31, 23], [37, 28], [44, 33], [54, 41]),
            'x6': makeRange([26, 20], [36, 28], [43, 34], [51, 40], [64, 51]),
        };
        // Fix specific ranges
        shaftToleranceData['u6']['24-30'] = [61, 48];
        shaftToleranceData['x6']['24-30'] = [77, 64];
        shaftToleranceData['t6']['24-30'] = [64, 48];

        // --- DOM ELEMENTS ---
        const themeSelect = document.getElementById('themeSelect');
        const tabBtnScrew = document.getElementById('tabBtnScrew');
        const tabBtnTolerance = document.getElementById('tabBtnTolerance');
        const viewScrew = document.getElementById('viewScrew');
        const viewTolerance = document.getElementById('viewTolerance');
        
        // Screw Tool Elements
        const screwSelect = document.getElementById('screwSelect');
        const screwPitch = document.getElementById('screwPitch');
        const screwHole = document.getElementById('screwHole');

        // Tolerance Tool Elements
        const diameterInput = document.getElementById('diameterInput');
        const holeClassSelect = document.getElementById('holeClassSelect');
        const shaftClassSelect = document.getElementById('shaftClassSelect');
        
        const dispHoleClass = document.getElementById('dispHoleClass');
        const dispShaftClass = document.getElementById('dispShaftClass');
        const dispHoleDia = document.getElementById('dispHoleDia');
        const dispShaftDia = document.getElementById('dispShaftDia');
        
        const holeTolMax = document.getElementById('holeTolMax');
        const holeTolMin = document.getElementById('holeTolMin');
        const holeAbsMax = document.getElementById('holeAbsMax');
        const holeAbsMin = document.getElementById('holeAbsMin');
        
        const shaftTolMax = document.getElementById('shaftTolMax');
        const shaftTolMin = document.getElementById('shaftTolMin');
        const shaftAbsMax = document.getElementById('shaftAbsMax');
        const shaftAbsMin = document.getElementById('shaftAbsMin');
        
        const fitIndicator = document.getElementById('fitIndicator');
        const fitTypeLabel = document.getElementById('fitTypeLabel');
        const fitVal1 = document.getElementById('fitVal1');
        const fitVal2 = document.getElementById('fitVal2');
        const fitVal1Label = document.getElementById('fitVal1Label');
        const fitVal2Label = document.getElementById('fitVal2Label');

        const tolError = document.getElementById('tolError');
        const tolResults = document.getElementById('tolResults');

        // --- INITIALIZATION ---
        function init() {
            // Populate Screw Select
            screwHoleData.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.label;
                opt.textContent = s.label;
                if(s.label === 'M3') opt.selected = true;
                screwSelect.appendChild(opt);
            });

            // Populate Hole Classes
            Object.keys(holeToleranceData).forEach(k => {
                const opt = document.createElement('option');
                opt.value = k;
                opt.textContent = k;
                if(k === 'H7') opt.selected = true;
                holeClassSelect.appendChild(opt);
            });

            // Populate Shaft Classes
            Object.keys(shaftToleranceData).forEach(k => {
                const opt = document.createElement('option');
                opt.value = k;
                opt.textContent = k;
                if(k === 'h7') opt.selected = true;
                shaftClassSelect.appendChild(opt);
            });

            // Initial Calculations
            updateScrew();
            updateTolerance();
        }

        // --- EVENT LISTENERS ---
        
        // Theme Switching
        themeSelect.addEventListener('change', (e) => {
            document.body.setAttribute('data-theme', e.target.value);
        });

        // Tab Switching
        tabBtnScrew.addEventListener('click', () => {
            tabBtnScrew.classList.replace('tab-inactive', 'tab-active');
            tabBtnTolerance.classList.replace('tab-active', 'tab-inactive');
            viewScrew.classList.remove('hidden');
            viewTolerance.classList.add('hidden');
        });

        tabBtnTolerance.addEventListener('click', () => {
            tabBtnTolerance.classList.replace('tab-inactive', 'tab-active');
            tabBtnScrew.classList.replace('tab-active', 'tab-inactive');
            viewTolerance.classList.remove('hidden');
            viewScrew.classList.add('hidden');
        });

        // Screw Tool Logic
        screwSelect.addEventListener('change', updateScrew);
        function updateScrew() {
            const val = screwSelect.value;
            const data = screwHoleData.find(s => s.label === val);
            if (data) {
                screwPitch.textContent = data.pitch.toFixed(2);
                screwHole.textContent = data.hole.toFixed(2);
            }
        }

        // Tolerance Tool Logic
        diameterInput.addEventListener('input', updateTolerance);
        holeClassSelect.addEventListener('change', updateTolerance);
        shaftClassSelect.addEventListener('change', updateTolerance);

        function updateTolerance() {
            const d = parseFloat(diameterInput.value);
            const hClass = holeClassSelect.value;
            const sClass = shaftClassSelect.value;

            // Basic Validation
            if (isNaN(d) || d <= 0) {
                showError('正の数値を入力してください');
                return;
            }
            if (d > 30) {
                showError('※今回は30mm以下のデータのみ実装されています');
                return;
            }

            // Find Range Key
            let rangeKey = null;
            for (const r of rangeKeys) {
                if (d <= r.max) {
                    rangeKey = r.key;
                    break;
                }
            }

            if (!rangeKey) {
                showError('範囲外の数値です');
                return;
            }

            const holeTols = holeToleranceData[hClass]?.[rangeKey];
            const shaftTols = shaftToleranceData[sClass]?.[rangeKey];

            if (!holeTols || !shaftTols || holeTols[0] === null || shaftTols[0] === null) {
                showError('データが存在しません (または範囲外)');
                return;
            }

            // Hide Error, Show Results
            tolError.classList.add('hidden');
            tolResults.classList.remove('hidden');

            // Calculations
            const holeMax = d + (holeTols[0] / 1000);
            const holeMin = d + (holeTols[1] / 1000);
            const shaftMax = d + (shaftTols[0] / 1000);
            const shaftMin = d + (shaftTols[1] / 1000);

            // Update DOM Texts
            dispHoleClass.textContent = hClass;
            dispShaftClass.textContent = sClass;
            dispHoleDia.textContent = d;
            dispShaftDia.textContent = d;

            const fmt = (v) => {
                const mm = v / 1000;
                return mm > 0 ? `+${mm.toFixed(3)}` : (mm === 0 ? '0' : mm.toFixed(3));
            };

            holeTolMax.textContent = fmt(holeTols[0]);
            holeTolMin.textContent = fmt(holeTols[1]);
            holeAbsMax.textContent = holeMax.toFixed(3);
            holeAbsMin.textContent = holeMin.toFixed(3);

            shaftTolMax.textContent = fmt(shaftTols[0]);
            shaftTolMin.textContent = fmt(shaftTols[1]);
            shaftAbsMax.textContent = shaftMax.toFixed(3);
            shaftAbsMin.textContent = shaftMin.toFixed(3);

            // Fit Calculation
            const maxGap = holeMax - shaftMin;
            const minGap = holeMin - shaftMax;

            fitIndicator.className = 'w-3 h-3 rounded-full animate-pulse'; // reset

            if (minGap >= 0) {
                fitTypeLabel.textContent = '隙間ばめ (Clearance)';
                fitIndicator.classList.add('bg-green-400');
                fitVal1Label.textContent = '最大隙間';
                fitVal1.textContent = (maxGap * 1000).toFixed(0);
                fitVal2Label.textContent = '最小隙間';
                fitVal2.textContent = (minGap * 1000).toFixed(0);
            } else if (maxGap <= 0) {
                fitTypeLabel.textContent = 'しまりばめ (Interference)';
                fitIndicator.classList.add('bg-red-400');
                // Interference is usually positive value
                const maxInt = shaftMax - holeMin;
                const minInt = shaftMin - holeMax;
                fitVal1Label.textContent = '最大締め代';
                fitVal1.textContent = (maxInt * 1000).toFixed(0);
                fitVal2Label.textContent = '最小締め代';
                fitVal2.textContent = (minInt * 1000).toFixed(0);
            } else {
                fitTypeLabel.textContent = '中間ばめ (Transition)';
                fitIndicator.classList.add('bg-yellow-400');
                const maxInt = shaftMax - holeMin;
                fitVal1Label.textContent = '最大隙間';
                fitVal1.textContent = (maxGap * 1000).toFixed(0);
                fitVal2Label.textContent = '最大締め代';
                fitVal2.textContent = (maxInt * 1000).toFixed(0);
            }
        }

        function showError(msg) {
            tolError.textContent = msg;
            tolError.classList.remove('hidden');
            tolResults.classList.add('hidden');
        }

        // Run Init
        init();

    </script>
</body>
</html>
