<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chocolate Calculator</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Optional for nice sans-serif) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            overflow: hidden; /* Prevent scrolling on mobile */
        }
        /* Custom scrollbar hiding */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (Inline SVGs to replace lucide-react for standalone HTML) ---
        const IconHistory = ({ size = 24, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
        );

        const IconMoreVertical = ({ size = 24, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="1"/>
                <circle cx="12" cy="5" r="1"/>
                <circle cx="12" cy="19" r="1"/>
            </svg>
        );

        const IconDelete = ({ size = 24, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
                <line x1="18" y1="9" x2="12" y2="15"/>
                <line x1="12" y1="9" x2="18" y2="15"/>
            </svg>
        );

        const IconChevronDown = ({ size = 24, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m6 9 6 6 6-6"/>
            </svg>
        );

        // --- Main App Component ---
        const App = () => {
            const [input, setInput] = useState('');
            const [result, setResult] = useState('');
            const [history, setHistory] = useState([]);
            const [currentTheme, setCurrentTheme] = useState('mint');
            const scrollRef = useRef(null);

            // Themes Configuration
            const themes = {
                mint: {
                    name: 'Mint Choco',
                    bg: 'bg-[#2B1B17]', 
                    display: 'text-[#40E0D0]', 
                    preview: 'text-[#80CBC4]',
                    btnNum: 'bg-[#3E2723] hover:bg-[#4E342E]', 
                    btnOp: 'bg-[#006064] hover:bg-[#00838F]', 
                    btnAc: 'bg-[#004D40] hover:bg-[#00695C]', 
                    btnEq: 'bg-[#40E0D0] hover:bg-[#84FFFF]', 
                    textNum: 'text-[#E0F2F1]', 
                    textOp: 'text-[#80CBC4]',
                    textAc: 'text-[#B2DFDB]',
                    textEq: 'text-[#2B1B17]', 
                    dot: 'bg-[#40E0D0]' 
                },
                banana: {
                    name: 'Choco Banana',
                    bg: 'bg-[#2B1B17]', 
                    display: 'text-[#FFEA00]', 
                    preview: 'text-[#FFF176]',
                    btnNum: 'bg-[#3E2723] hover:bg-[#4E342E]', 
                    btnOp: 'bg-[#F57F17] hover:bg-[#F9A825]', 
                    btnAc: 'bg-[#E65100] hover:bg-[#EF6C00]', 
                    btnEq: 'bg-[#FFEA00] hover:bg-[#FFFF00]', 
                    textNum: 'text-[#FFF8E1]', 
                    textOp: 'text-[#261C19]', 
                    textAc: 'text-[#FFF3E0]',
                    textEq: 'text-[#2B1B17]', 
                    dot: 'bg-[#FFEA00]'
                },
                strawberry: {
                    name: 'Strawberry Choco',
                    bg: 'bg-[#2B1B17]', 
                    display: 'text-[#FF2A68]', 
                    preview: 'text-[#FF80AB]',
                    btnNum: 'bg-[#3E2723] hover:bg-[#4E342E]', 
                    btnOp: 'bg-[#C2185B] hover:bg-[#D81B60]', 
                    btnAc: 'bg-[#880E4F] hover:bg-[#AD1457]', 
                    btnEq: 'bg-[#FF2A68] hover:bg-[#FF4081]', 
                    textNum: 'text-[#FCE4EC]', 
                    textOp: 'text-[#F8BBD0]',
                    textAc: 'text-[#F8BBD0]',
                    textEq: 'text-[#FCE4EC]', 
                    dot: 'bg-[#FF2A68]'
                }
            };

            const theme = themes[currentTheme];

            useEffect(() => {
                if (scrollRef.current) {
                    scrollRef.current.scrollLeft = scrollRef.current.scrollWidth;
                }
            }, [input, result]);

            const handleParentheses = () => {
                const openCount = (input.match(/\(/g) || []).length;
                const closeCount = (input.match(/\)/g) || []).length;
                const lastChar = input.slice(-1);

                if ((['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ')'].includes(lastChar)) && openCount > closeCount) {
                    setInput(input + ')');
                } else {
                    setInput(input + '(');
                }
            };

            const calculate = (expression) => {
                try {
                    let formatted = expression
                        .replace(/×/g, '*')
                        .replace(/÷/g, '/')
                        .replace(/√\(/g, 'Math.sqrt(')
                        .replace(/(\d+)%/g, '($1/100)');
                    
                    const openCount = (formatted.match(/\(/g) || []).length;
                    const closeCount = (formatted.match(/\)/g) || []).length;
                    if (openCount > closeCount) {
                        formatted += ')'.repeat(openCount - closeCount);
                    }

                    const evalResult = new Function('return ' + formatted)();
                    const finalResult = String(Math.round(evalResult * 10000000000) / 10000000000);
                    return finalResult;
                } catch (error) {
                    return null;
                }
            };

            const handleClick = (value) => {
                if (value === 'AC') {
                    setInput('');
                    setResult('');
                } else if (value === 'DEL') {
                    setInput(input.slice(0, -1));
                } else if (value === '=') {
                    if (!input) return;
                    const res = calculate(input);
                    if (res !== null) {
                        setHistory([...history, { eq: input, res }]);
                        setInput(res);
                        setResult('');
                    } else {
                        setResult('Error');
                    }
                } else if (value === '( )') {
                    handleParentheses();
                } else if (value === '√') {
                    setInput(input + '√(');
                } else if (['+', '-', '×', '÷', '%'].includes(value)) {
                    const lastChar = input.slice(-1);
                    if (['+', '-', '×', '÷'].includes(lastChar)) {
                        setInput(input.slice(0, -1) + value);
                    } else {
                        setInput(input + value);
                    }
                } else {
                    const newInput = input + value;
                    setInput(newInput);
                    
                    if (!['+', '-', '×', '÷', '(', '√'].includes(value)) {
                        const preview = calculate(newInput);
                        if (preview !== null) {
                            setResult(preview);
                        }
                    }
                }
            };

            const Button = ({ label, type = 'num' }) => {
                let colorClass = '';
                let textClass = '';
                
                switch (type) {
                    case 'ac': colorClass = theme.btnAc; textClass = theme.textAc; break;
                    case 'op': colorClass = theme.btnOp; textClass = theme.textOp; break;
                    case 'eq': colorClass = theme.btnEq; textClass = theme.textEq; break;
                    case 'num': default: colorClass = theme.btnNum; textClass = theme.textNum; break;
                }

                const content = label === 'DEL' ? <IconDelete size={24} /> : label;

                return (
                    <button
                        onClick={() => handleClick(label === 'DEL' ? 'DEL' : label)}
                        className={`
                            ${colorClass} ${textClass} 
                            rounded-full aspect-square
                            w-full h-full
                            flex items-center justify-center 
                            text-3xl font-normal 
                            transition-all duration-200 active:scale-90 active:brightness-110
                            select-none shadow-md
                            cursor-pointer
                        `}
                    >
                        {content}
                    </button>
                );
            };

            return (
                <div className={`min-h-screen w-full ${theme.bg} flex items-center justify-center p-4 transition-colors duration-500`}>
                    <div className={`w-full max-w-[360px] h-[800px] max-h-[90vh] flex flex-col relative overflow-hidden rounded-[32px] border border-[#3E2723] shadow-2xl shadow-black/50 transition-colors duration-500`}>
                        
                        {/* Top Bar */}
                        <div className={`flex justify-between items-center p-4 ${theme.display} opacity-70`}>
                            <IconHistory size={20} className="cursor-pointer hover:text-white transition-colors" />
                            <span className="text-xs tracking-widest opacity-50 uppercase font-bold">{theme.name}</span>
                            <IconMoreVertical size={20} className="cursor-pointer hover:text-white transition-colors" />
                        </div>

                        {/* Display Area */}
                        <div className="flex-1 flex flex-col justify-end items-end p-6 pb-2 space-y-2">
                            {/* Realtime Preview */}
                            {result && result !== input && (
                                <div className={`text-2xl ${theme.preview} opacity-70 font-light tracking-wide truncate w-full text-right transition-colors duration-300`}>
                                    {result}
                                </div>
                            )}
                            
                            {/* Main Input */}
                            <div 
                                ref={scrollRef}
                                className={`
                                    w-full text-right ${theme.display} overflow-x-auto scrollbar-hide whitespace-nowrap
                                    ${input.length > 10 ? 'text-5xl' : 'text-7xl'} font-light tracking-tight drop-shadow-md transition-colors duration-300
                                `}
                            >
                                {input || '0'}
                            </div>
                        </div>

                        {/* Actions Bar (Theme Switcher) */}
                        <div className="px-6 py-2 flex justify-between items-center">
                            <div className="flex items-center gap-3 bg-black/20 p-1.5 rounded-full backdrop-blur-sm">
                                {/* Theme Dots */}
                                <button 
                                    onClick={() => setCurrentTheme('mint')}
                                    className={`w-4 h-4 rounded-full bg-[#40E0D0] ring-2 ring-offset-2 ring-offset-[#2B1B17] transition-all cursor-pointer ${currentTheme === 'mint' ? 'ring-[#40E0D0] scale-110' : 'ring-transparent opacity-50 hover:opacity-100'}`}
                                    title="Mint Choco"
                                ></button>
                                <button 
                                    onClick={() => setCurrentTheme('banana')}
                                    className={`w-4 h-4 rounded-full bg-[#FFEA00] ring-2 ring-offset-2 ring-offset-[#2B1B17] transition-all cursor-pointer ${currentTheme === 'banana' ? 'ring-[#FFEA00] scale-110' : 'ring-transparent opacity-50 hover:opacity-100'}`}
                                    title="Choco Banana"
                                ></button>
                                <button 
                                    onClick={() => setCurrentTheme('strawberry')}
                                    className={`w-4 h-4 rounded-full bg-[#FF2A68] ring-2 ring-offset-2 ring-offset-[#2B1B17] transition-all cursor-pointer ${currentTheme === 'strawberry' ? 'ring-[#FF2A68] scale-110' : 'ring-transparent opacity-50 hover:opacity-100'}`}
                                    title="Strawberry Choco"
                                ></button>
                            </div>
                            <IconChevronDown size={20} className={`${theme.display} opacity-50`} />
                        </div>

                        {/* Keypad Area */}
                        <div className="p-4 pb-8 grid grid-cols-4 gap-3 content-end flex-shrink-0">
                            {/* Row 1 */}
                            <Button label="AC" type="ac" />
                            <Button label="√" type="op" />
                            <Button label="( )" type="op" />
                            <Button label="÷" type="op" />

                            {/* Row 2 */}
                            <Button label="7" />
                            <Button label="8" />
                            <Button label="9" />
                            <Button label="×" type="op" />

                            {/* Row 3 */}
                            <Button label="4" />
                            <Button label="5" />
                            <Button label="6" />
                            <Button label="-" type="op" />

                            {/* Row 4 */}
                            <Button label="1" />
                            <Button label="2" />
                            <Button label="3" />
                            <Button label="+" type="op" />

                            {/* Row 5 */}
                            <Button label="0" />
                            <Button label="." />
                            <Button label="DEL" />
                            <Button label="=" type="eq" />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>